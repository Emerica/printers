[include mainsail.cfg]
[include minilcd.cfg]
[mcu]
serial:  /dev/serial/by-id/usb-Klipper_stm32h723xx_2A002A001351313531383332-if00

#[temperature_sensor mcu_temp]
#sensor_type: temperature_mcu
#sensor_mcu: mcu
#min_temp: 0
#max_temp: 100

[temperature_sensor pi_temp]
sensor_type: temperature_host


[virtual_sdcard]
path: /home/e/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

[printer]
kinematics: none
max_velocity: 1000
max_accel: 1000

[temperature_fan DRIVERS]
pin: PD12
kick_start_time: 0.5
hardware_pwm: false
max_power: 1.0
shutdown_speed: 0.0
cycle_time: 0.01
sensor_type: temperature_host
target_temp: 38          # Fan barely moves below ~40°C, ramps above
min_temp: 0
max_temp: 70
min_speed: 0.35          # 35% at idle/room temp — quiet!
max_speed: 0.8
control: watermark       # ← No PID needed
max_delta: 3.0           # Adjust: smaller = more responsive (e.g. 3-4), larger = lazier/quieter (e.g. 6-8)

[temperature_fan MOBOSSR]
pin: PD13
kick_start_time: 0.5
hardware_pwm: false
max_power: 1.0
shutdown_speed: 0.0
cycle_time: 0.01
sensor_type: temperature_mcu
target_temp: 38          # Fan barely moves below ~40°C, ramps above
min_temp: 0
max_temp: 70
min_speed: 0.35          # 35% at idle/room temp — quiet!
max_speed: 0.8
control: watermark       # ← No PID needed
max_delta: 3.0           # Adjust: smaller = more responsive (e.g. 3-4), larger = lazier/quieter (e.g. 6-8)


[fan_generic PSU48V]
pin: PD14
max_power: 1.0
kick_start_time: 0.5
hardware_pwm: true          # ← Key change: enables hardware PWM
shutdown_speed: 0.2         # Now allowed! 20% during shutdown/error
cycle_time: 0.00004         # Optional: ~25 kHz — good for quiet fans, omit if you want default (~100 Hz)

[fan_generic PSU24V]
pin: PD15
max_power: 1.0
kick_start_time: 0.5
hardware_pwm: true
shutdown_speed: 0.2
cycle_time: 0.00004         # Same as above


[delayed_gcode STARTUP_PSU_FANS]
initial_duration: 5               # Wait ~5 seconds after Klipper is "ready" (adjust if needed, min 1s)
gcode:
    SET_FAN_SPEED FAN=PSU48V SPEED=0.2
    SET_FAN_SPEED FAN=PSU24V SPEED=0.2
    # Optional: Respond info so you see it in console
    {action_respond_info("PSU fans set to 20% on startup")}



[thermistor r3men_bed]
temperature1: 25
resistance1: 100000
temperature2: 97
resistance2: 1385
temperature3: 248
resistance3: 165


[heater_bed]
heater_pin: PB0
sensor_type: r3men_bed
sensor_pin:  PF3
max_power: 0.8
min_temp: 0
max_temp: 100      
control: watermark
